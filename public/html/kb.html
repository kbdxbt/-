<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>教务系统成绩</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <link rel="stylesheet" href="css/weui.css"/>
    <link rel="stylesheet" href="css/weui2.css"/>
    <link rel="stylesheet" href="css/weui3.css"/>
    <link rel="stylesheet" href="css/weuix.css"/>
    <script src="js/zepto.min.js"></script>
    <script src="js/zepto.weui.js"></script>
    <script src="js/vue.min.js"></script>
    <script src="js/echo.min.js"></script>
</head>

<style type="text/css">
.weui__mask {
    position: fixed;
    z-index: 1000;
    top: 0;
    right: 0;
    left: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
}
.td{
    margin-left: 100px;
    font-size:12px;
    color:#fff;
    background-color:#E3E3E3;
    border-radius:5px;
    opacity:0.7;
    border: 0;
    line-height: 15px;
    padding: 5px 5px;
    max-width: 15%;
    height:80px;
}
table th,.td1{
    border: 0;
    text-align: center;
    font-weight: normal;
    width: 50px;
    padding: 5px 2px;
    background-color: #EDEDED;
    font-size: 12px;
    color: #18b4ed;
    max-width: 15%;
}
table td{
    border: 0;
    text-align: center;
    font-weight: normal;
    height: 50px;
    padding: 5px 0px;
    font-size: 12px;
}
.td1 {
    background-color: #EDEDED;
    font-size: 12px;
    color: #18b4ed;
    width:20px;
}
.touming {
    background: url(./images/touming.png) no-repeat top right;
}
</style>
<body ontouchstart style="background-color: #f8f8f8;">
<div class="form" id="app">
<div class="weui-header bg-blue" style="display:none;"> 
    <div class="weui-header-left"> 
        <a href="index.html" class="icon icon-109 f-white"></a> 
    </div>
    <h1 class="weui-header-title" id="text2" style="margin:0 50px;">
    <div style="line-height:15px;">
        <div style="top:2px;position:relative;width:100%;height:40px;"><span>第{{week}}周</span><br/><span @click.stop="weekList" style="font-size: 12px;">{{semester[current]}}<span class="icon icon-74"></span></span></div>
    </div></h1>
    <div class="weui-header-right" @click="handleChange">
        <a href="javascript:;"  id="act" class="icon icon-83 f-white"></a>
    </div> 
</div>
<div class="weui-skin_android" v-show="is_week">
    <div class="weui__mask" @click.stop="cancelSelect"></div>
    <div class="weui-actionsheet">
        <div class="weui-actionsheet__menu"  style="overflow-y:scroll; overflow-x:hidden;height:300px; width:274px; margin:auto;">
            <div class="weui-actionsheet__menu">
            <div class="weui-actionsheet__cell" v-for="(item,index) in 25" @click.stop="handleWeek(item)">第{{item}}周<i class="weui-icon-success-no-circle" v-if="item==week"></i></div>
        </div>
        </div>
    </div>
</div>
<div class="weui-skin_android" v-show="is_select">
    <div class="weui__mask" @click.stop="cancelSelect"></div>
    <div class="weui-actionsheet">
        <div class="weui-actionsheet__menu"  style="overflow-y:scroll; overflow-x:hidden;height:300px; width:274px; margin:auto;">
            <div class="weui-actionsheet__cell" v-for="(item,index) in semester" @click.stop="handleInfo(index)">{{item}}<i class="weui-icon-success-no-circle" v-if="index==current"></i></div>
        </div>
    </div>
</div>
<div class="contianer page-bg" style="display:none">
    <table> 
        <thead>
        <tr>
            <th style="width:30px;">12月</th>
            <th>1</th>
            <th>2</th>
            <th>3</th>
            <th>4</th>
            <th>5</th>
            <th>6</th>
            <th>7</th>
        </tr>
        </thead>
        <tbody >
            <tr v-for="(item, index) in list">
            <td class="td1">{{index}}</td>
            <td v-if="value.show && value.take" :rowspan="value.col" v-for="(value, key) in item[0]" :style="{'background-color':(value.class?value.color:''),color:(value.class?'#fff':'#999')}" :class="{td:value.name,touming:value.type}" @click="showAlert(item[0])">{{value.name}}{{value.name?'@':''}}{{value.classroom}}</td></span>
            <td v-if="value.show && value.take" :rowspan="value.col" v-for="(value, key) in item[1]" :style="{'background-color':(value.class?value.color:''),color:(value.class?'#fff':'#999')}" :class="{td:value.name,touming:value.type}" @click="showAlert(item[1])">{{value.name}}{{value.name?'@':''}}{{value.classroom}}</td>
            <td v-if="value.show && value.take" :rowspan="value.col" v-for="(value, key) in item[2]" :style="{'background-color':(value.class?value.color:''),color:(value.class?'#fff':'#999')}" :class="{td:value.name,touming:value.type}" @click="showAlert(item[2])">{{value.name}}{{value.name?'@':''}}{{value.classroom}}</td>
            <td v-if="value.show && value.take" :rowspan="value.col" v-for="(value, key) in item[3]" :style="{'background-color':(value.class?value.color:''),color:(value.class?'#fff':'#999')}" :class="{td:value.name,touming:value.type}" @click="showAlert(item[3])">{{value.name}}{{value.name?'@':''}}{{value.classroom}}</td>
            <td v-if="value.show && value.take" :rowspan="value.col" v-for="(value, key) in item[4]" :style="{'background-color':(value.class?value.color:''),color:(value.class?'#fff':'#999')}" :class="{td:value.name,touming:value.type}" @click="showAlert(item[4])">{{value.name}}{{value.name?'@':''}}{{value.classroom}}</td>
            <td v-if="value.show && value.take" :rowspan="value.col" v-for="(value, key) in item[5]" :style="{'background-color':(value.class?value.color:''),color:(value.class?'#fff':'#999')}" :class="{td:value.name,touming:value.type}" @click="showAlert(item[5])">{{value.name}}{{value.name?'@':''}}{{value.classroom}}</td>
            <td v-if="value.show && value.take" :rowspan="value.col" v-for="(value, key) in item[6]" :style="{'background-color':(value.class?value.color:''),color:(value.class?'#fff':'#999')}" :class="{td:value.name,touming:value.type}" @click="showAlert(item[6])">{{value.name}}{{value.name?'@':''}}{{value.classroom}}</td>
        </tbody>
    </table>
</div>
<script> 
    (function () {
        var app = new Vue({
            el: '#app',
            data: {
                url: 'http://localhost/rxkj/public/index.php/',
                list: '',
                info: '',
                current: '',
                semester: [],
                cj_show: false,
                is_select: false,
                is_week: false,
                week: 1,
                klist: [0,1,2,3,4,5,6],
            },
            mounted: function () {
            },
            methods: {
                getKbOption: function () {
                    var self = this;
                    $.ajax({
                        url: self.url + 'index/student/getKbOption',    //请求的url地址
                        type : 'GET',
                        dataType : "json",  //json类型
                        data : '',
                        async : true,
                        beforeSend: function() {
                            $.showLoading();
                        },
                        success : function (response, stutas, xhr) {
                            if (response.code != 0) {
                                window.location.href = "login.html"
                            }
                            self.semester = response.data;
                        },
                        error: function(){
                            window.location.href = "login.html"
                        }
                    }); 
                },
                handleChange: function(event) {
                    var self = this;
                    self.is_select = true;
                },
                handleInfo: function(item) {
                    var self = this;
                    $.ajax({
                        url: self.url + 'index/student/getKbInfo',    //请求的url地址
                        type : 'POST',
                        dataType : "json",  //json类型
                        data : {xueqi : item, week : self.week},
                        async : true,
                        beforeSend: function() {
                            $.showLoading();
                        },
                        success : function (response, stutas, xhr) {
                            $.hideLoading();
                            if (response.code != 0) {
                                window.location.href = "login.html"
                            }
                            self.list = response.data[0];
                            self.current = response.data['xueqi'];
                            $(".contianer").show();
                            $("#weui-top").show();
                            $('.weui-header').show();
                        },
                        error: function(){
                            window.location.href = "login.html"
                        }
                    }); 
                    self.info = self.list[item];
                    self.is_select = false;
                },
                handleWeek: function (item) {
                    var self = this;
                    self.week = item;
                    self.handleInfo(self.current);
                    self.is_week = false;
                },
                back: function() {
                    window.location.href = "index.html"
                },
                showAlert: function(item) {
                    var data = '';
                    for (let i=0; i<item.length; i++) {
                        if (item[i]['name']) {
                            if (item[i]['class'] == '1') {
                                data += "<div class='weui-label-list'><label class='label f-green b-green'>本周</label></div>";
                            } else {
                                data += "<div class='weui-label-list'><label class='label f-red b-red'>非本周</label></div>";
                            }
                            data += "<span style='float:left;'>课　　程:</span>"+item[i]['name']+"<br><span style='float:left;'>教　　室:</span>"+item[i]['classroom']+"<br><span style='float:left;'>老　　师:</span>"+item[i]['teacher']+"<br><span style='float:left;'>节　　数:</span>"+item[i]['timeinfo']+"<br><span style='float:left;'>周　　数:</span>"+item[i]['weekinfo']+"<br><br><div style='background-color:#E3E3E3;height:1px;border:none;'></div>";
                        }
                    }
                    if (data) {
                        $.alert(data,"课程信息");
                    }
                },
                cancelSelect: function() {
                    var self = this;
                    self.is_select = false;
                    self.is_week = false;
                },
                weekList: function() {
                    var self = this;
                    self.is_week = true;
                }
            }
        });
        app.getKbOption();
        app.handleInfo();
    })();
</script>
</body>
</html>